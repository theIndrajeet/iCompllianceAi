<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iCompliance | Cross-Border Hiring Assessment</title>
    <!-- Navigation CSS -->
    <link rel="stylesheet" href="navigation.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <style>
        :root {
            --primary: #4F46E5;
            --secondary: #7C3AED;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            --dark: #0F172A;
            --darker: #1E293B;
            --card: #1E293B;
            --border: #334155;
            --text: #F1F5F9;
            --text-muted: #94A3B8;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--dark);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .back-button-container {
            text-align: center;
            margin: -2rem auto 3rem;
        }

        .back-button, .ai-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            background: var(--darker);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-muted);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .ai-btn {
             background: var(--gradient-3);
             color: white;
             border: none;
        }

        .back-button:hover, .ai-btn:hover {
            background: var(--card);
            color: var(--text);
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .ai-btn:hover {
             box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
        }


        .hero {
            text-align: center;
            padding: 4rem 0;
            background: linear-gradient(180deg, rgba(79, 70, 229, 0.1) 0%, transparent 100%);
        }

        .hero h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: var(--gradient-1);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--text-muted);
            max-width: 600px;
            margin: 0 auto;
        }

        .glass-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }

        .checklist-items {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            cursor: pointer;
            padding: 1rem;
            background: var(--darker);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .checklist-item:hover {
            background: rgba(79, 70, 229, 0.1);
            transform: translateX(4px);
        }

        .checklist-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--primary);
            cursor: pointer;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .checklist-item span {
            flex: 1;
            font-size: 1rem;
            line-height: 1.5;
        }

        .checklist-item input[type="checkbox"]:checked + span {
            text-decoration: line-through;
            color: var(--text-muted);
        }

        .calculate-btn {
            background: var(--gradient-1);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }

        .step-number {
            width: 35px;
            height: 35px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            flex-shrink: 0;
        }

        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .info-icon {
            color: var(--info);
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .jurisdiction-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 600;
            margin: 0.25rem;
        }

        .badge-green {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .badge-blue {
            background: rgba(59, 130, 246, 0.2);
            color: var(--info);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .badge-red {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .main-grid {
             display: grid; 
             grid-template-columns: 1fr 2.5fr; /* Adjusted ratio */
             gap: 2rem; 
             margin-bottom: 3rem;
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none; 
            align-items: center; 
            justify-content: center; 
            opacity: 0;
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .modal-overlay.active {
            display: flex; 
            opacity: 1;
        }
        .modal-content {
            background: var(--darker);
            border: 1px solid var(--border);
            border-radius: 24px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transform: scale(0.95);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
        .modal-header {
            position: sticky;
            top: 0;
            background: var(--darker); 
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border);
            z-index: 10;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
        }
        .modal-header h2 { 
            font-size: 1.5rem;
            color: var(--text);
            flex-grow: 1;
        }
        .modal-close {
            background: var(--dark);
            border: 1px solid var(--border);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            flex-shrink: 0; 
        }
        .modal-close:hover {
            background: var(--danger);
            border-color: var(--danger);
            color: white;
            transform: rotate(90deg);
        }
        .modal-body {
            padding: 2rem;
            line-height: 1.7;
        }
        .modal-body h3 { color: var(--primary); margin-top: 1.5rem; margin-bottom: 0.5rem; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; }
        .modal-body ul { list-style-position: inside; padding-left: 1rem; }
        .modal-body li { margin-bottom: 0.5rem; }
        .modal-body p { margin-bottom: 1rem; color: var(--text-muted); }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-left-color: var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 3rem auto;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        @media (max-width: 992px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
             .progress-sidebar {
                 position: static;
             }
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
            
            .glass-card {
                padding: 1.5rem;
            }
             .nav-menu {
                display: none;
             }
        }
    </style>
</head>
<body>
    <!-- Background -->
    <div class="universe-bg">
        <div class="floating-orb orb-1"></div>
        <div class="floating-orb orb-2"></div>
        <div class="floating-orb orb-3"></div>
    </div>

    <!-- Main Content -->
    <main>
        <div class="container">
            <div class="hero">
                <h1>Cross-Border Hiring Assessment</h1>
                <p>
                    Evaluate healthcare professionals' ability to serve clients across multiple jurisdictions
                </p>
            </div>

            <!-- Back Button -->
            <div class="back-button-container">
                <a href="./index.html" class="back-button">
                    <i class="fas fa-arrow-left"></i>
                    <span>Back to Dashboard</span>
                </a>
            </div>
            
            <div class="info-box" style="max-width: 800px; margin: 0 auto 3rem;">
                <span class="info-icon">i</span>
                <div>
                    <strong>Purpose:</strong> This checklist helps assess candidates' cross-border practice capabilities, identify which markets they can serve, and document compliance requirements for different jurisdiction pairs.
                </div>
            </div>

            <div class="main-grid">
                <!-- Progress Sidebar -->
                <div class="glass-card progress-sidebar" style="height: fit-content; position: sticky; top: 100px;">
                    <h3 style="margin-bottom: 1.5rem;">Assessment Progress</h3>
                    <div id="progressBar" style="width: 100%; height: 8px; background: var(--darker); border-radius: 4px; margin-bottom: 2rem;">
                        <div id="progressFill" style="width: 0%; height: 100%; background: var(--gradient-1); border-radius: 4px; transition: width 0.3s;"></div>
                    </div>
                    <div id="progressText" style="text-align: center; font-size: 1.5rem; font-weight: 700; color: var(--primary); margin-bottom: 2rem;">0%</div>
                    
                    <div id="checklistStats" style="display: grid; gap: 1rem;">
                        <div style="padding: 1rem; background: var(--darker); border-radius: 8px;">
                            <div style="color: var(--text-muted); font-size: 0.875rem;">Assessed Items</div>
                            <div style="font-size: 1.25rem; font-weight: 600;" id="completedCount">0</div>
                        </div>
                        <div style="padding: 1rem; background: var(--darker); border-radius: 8px;">
                            <div style="color: var(--text-muted); font-size: 0.875rem;">Total Items</div>
                            <div style="font-size: 1.25rem; font-weight: 600;" id="totalCount">0</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 2rem; padding: 1rem; background: var(--darker); border-radius: 8px;">
                        <h4 style="font-size: 1rem; margin-bottom: 0.5rem;">Jurisdiction Legend</h4>
                        <div style="font-size: 0.875rem; color: var(--text-muted); line-height: 1.6;">
                            <div style="margin: 0.5rem 0;"><span class="jurisdiction-badge badge-green">GREEN</span> Full practice</div>
                            <div style="margin: 0.5rem 0;"><span class="jurisdiction-badge badge-blue">BLUE</span> Limited practice</div>
                            <div style="margin: 0.5rem 0;"><span class="jurisdiction-badge badge-red">RED</span> Not permitted</div>
                        </div>
                    </div>
                    
                    <button class="calculate-btn" style="margin-top: 2rem;" onclick="exportAssessment()">
                        Export Assessment Report
                    </button>
                    <button class="ai-btn" style="width: 100%; margin-top: 1rem;" onclick="generateAISummary()">
                        Generate AI Summary & Risks
                    </button>
                </div>

                <!-- Checklist Items -->
                <div>
                    <div class="glass-card" style="margin-bottom: 2rem;">
                        <h3 style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                            <div class="step-number">1</div>
                            Cross-Border License Mapping
                        </h3>
                        <div class="checklist-items">
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Map candidate's primary license jurisdiction and type</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Identify all countries where Intellect needs coverage</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Create jurisdiction matrix showing provider → client country permissions</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Document which countries candidate CAN serve (GREEN jurisdictions)</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Document which countries have limitations (BLUE jurisdictions)</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Note which countries candidate CANNOT serve (RED jurisdictions)</span>
                            </label>
                        </div>
                    </div>

                    <div class="glass-card" style="margin-bottom: 2rem;">
                        <h3 style="display: flex; align-items: center; justify-content: space-between; gap: 1rem; margin-bottom: 1.5rem;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div class="step-number">2</div>
                                International Practice Authorization
                            </div>
                            <button class="ai-btn" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="generateInterviewQuestions(this)">Suggest Questions</button>
                        </h3>
                        <div class="checklist-items">
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Verify if home license explicitly allows international teletherapy</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Check for any geographic restrictions on current license</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Identify reciprocity agreements between jurisdictions</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Document any temporary practice permits available</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Research interstate compacts or regional agreements (e.g., PSYPACT, EU mobility)</span>
                            </label>
                        </div>
                    </div>

                    <div class="glass-card" style="margin-bottom: 2rem;">
                         <h3 style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                            <div class="step-number">3</div>
                            Service Type Assessment by Market
                        </h3>
                        <div class="checklist-items">
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Determine which service types candidate can provide per jurisdiction</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Identify markets where only counselling/coaching is permitted (no diagnosis)</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Note markets where full clinical services are allowed</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Document any age restrictions (e.g., adults only, no minors)</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Check for specialty restrictions (e.g., substance abuse, couples therapy)</span>
                            </label>
                        </div>
                    </div>

                    <div class="glass-card" style="margin-bottom: 2rem;">
                        <h3 style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                            <div class="step-number">4</div>
                            Cross-Border Insurance Verification
                        </h3>
                        <div class="checklist-items">
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Verify malpractice insurance covers international teletherapy</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Check insurance validity for each target market</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Identify any excluded countries or regions in insurance policy</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Document additional insurance requirements for specific countries</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Note any insurance coverage gaps that need addressing</span>
                            </label>
                        </div>
                    </div>

                    <div class="glass-card" style="margin-bottom: 2rem;">
                        <h3 style="display: flex; align-items: center; justify-content: space-between; gap: 1rem; margin-bottom: 1.5rem;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div class="step-number">5</div>
                                Cultural & Language Competency
                            </div>
                             <button class="ai-btn" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="generateInterviewQuestions(this)">Suggest Questions</button>
                        </h3>
                        <div class="checklist-items">
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Assess language proficiencies for target markets</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Verify cultural competency training or experience</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Check time zone compatibility with target markets</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Document any market-specific certifications (e.g., cultural sensitivity)</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Identify markets where candidate has prior experience</span>
                            </label>
                        </div>
                    </div>

                    <div class="glass-card">
                        <h3 style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                            <div class="step-number">6</div>
                            Cross-Border Capability Summary
                        </h3>
                        <div class="checklist-items">
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Create comprehensive market coverage map for candidate</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Calculate percentage of Intellect's markets candidate can serve</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Document service limitations by jurisdiction</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Identify potential for expanding coverage (additional licenses/permits)</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateProgress()">
                                <span>Prepare cross-border practice agreement outlining permitted services</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- AI Modal -->
    <div class="modal-overlay" id="ai-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">AI Assistant</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- AI content will be injected here -->
            </div>
        </div>
    </div>

    <!-- Navigation Script -->
    <script src="navigation.js"></script>
    
    <script>
        const showdownConverter = new showdown.Converter();
        
        // Count total checkboxes on page load
        document.addEventListener('DOMContentLoaded', function() {
            const totalCheckboxes = document.querySelectorAll('input[type="checkbox"]').length;
            document.getElementById('totalCount').textContent = totalCheckboxes;
            updateProgress();
        });

        function updateProgress() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            const checkedBoxes = document.querySelectorAll('input[type="checkbox"]:checked');
            
            const total = checkboxes.length;
            if (total === 0) return; // Avoid division by zero
            
            const completed = checkedBoxes.length;
            const percentage = Math.round((completed / total) * 100);
            
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = percentage + '%';
            document.getElementById('completedCount').textContent = completed;
            
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');

            if (percentage === 100) {
                progressFill.style.background = 'var(--success)';
                progressText.style.color = 'var(--success)';
            } else if (percentage >= 80) {
                progressFill.style.background = 'var(--warning)';
                progressText.style.color = 'var(--warning)';
            } else {
                progressFill.style.background = 'var(--gradient-1)';
                progressText.style.color = 'var(--primary)';
            }
                }

        async function callGeminiAPI(prompt) {
            const apiKey = "AIzaSyC8YYkX29-4WyWBKWw-Sm6Cm2dATxgvpeA";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            
            const payload = {
              contents: [{ role: "user", parts: [{ text: prompt }] }],
            };
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    const errorBody = await response.text();
                    throw new Error(`API request failed with status ${response.status}: ${errorBody}`);
                }
                
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    console.error("Unexpected API response structure:", result);
                    return "Error: Could not parse the AI's response.";
                }
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                return `An error occurred while contacting the AI assistant: ${error.message}. Please check the console for more details.`;
            }
        }

        function openModal(title, contentHTML) {
            const modal = document.getElementById('ai-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            
            modalTitle.textContent = title;
            modalBody.innerHTML = contentHTML;
            modal.classList.add('active');
        }

        function closeModal() {
            const modal = document.getElementById('ai-modal');
            modal.classList.remove('active');
        }

        function showNotification(message, type = 'danger') {
            const notification = document.createElement('div');
            const colors = {
                info: 'var(--info)',
                success: 'var(--success)',
                danger: 'var(--danger)',
                warning: 'var(--warning)',
            };
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                background: ${colors[type] || colors.info};
                color: white;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                z-index: 9999;
                transform: translateY(200%);
                opacity: 0;
                transition: all 0.4s cubic-bezier(0.215, 0.610, 0.355, 1);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateY(0)';
                notification.style.opacity = '1';
            }, 10);

            setTimeout(() => {
                notification.style.transform = 'translateY(200%)';
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 400);
            }, 4000);
        }

        function generateAISummary() {
            const title = "Enter Candidate's Name";
            const content = `
                <p>Please enter the candidate's name to personalize the report.</p>
                <input type="text" id="candidateNameInput" placeholder="e.g., Jane Doe" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border); background: var(--dark); color: var(--text); font-size: 1rem; margin-bottom: 1rem;">
                <button class="ai-btn" style="width: 100%;" onclick="proceedWithAISummary()">Continue</button>
            `;
            openModal(title, content);
        }

        async function proceedWithAISummary() {
            const candidateNameInput = document.getElementById('candidateNameInput');
            const candidateName = candidateNameInput.value.trim() || 'the candidate';

            openModal(`AI Summary for ${candidateName}`, '<div class="loading-spinner"></div>');
            
            let checklistData = "Assessment Data:\n";
            document.querySelectorAll('.glass-card:not(.progress-sidebar)').forEach(sectionCard => {
                 const titleElement = sectionCard.querySelector('h3');
                 if (!titleElement) return;
                 const sectionTitle = titleElement.textContent.trim().replace(/^\d+\s*/, '');
                 checklistData += `\n## Section: ${sectionTitle}\n`;
                 const items = sectionCard.querySelectorAll('.checklist-item');
                 items.forEach(item => {
                    const checkbox = item.querySelector('input[type="checkbox"]');
                    const status = checkbox.checked ? '[COMPLETED]' : '[INCOMPLETE]';
                    const text = item.querySelector('span').textContent;
                    checklistData += `- ${status} ${text}\n`;
                 });
            });

            const prompt = `
                You are a senior compliance analyst for a global healthcare company called Intellect.
                Your task is to analyze the following cross-border hiring assessment checklist for a candidate named ${candidateName}.
                Based on the completed and incomplete items, provide a concise, professional report in Markdown format.
                
                The report must include these three sections:
                1.  **Overall Summary:** A brief, high-level overview of the candidate's readiness for cross-border roles.
                2.  **Potential Risks & Gaps:** A bulleted list identifying the key risks or missing information based on the *incomplete* items. Be specific. If a whole section is incomplete, highlight it as a major gap.
                3.  **Recommended Next Steps:** A numbered list of actionable recommendations for the hiring manager to address the identified risks and gaps.

                Here is the checklist data:
                ${checklistData}
            `;
            
            const aiResponse = await callGeminiAPI(prompt);
            document.getElementById('modal-body').innerHTML = showdownConverter.makeHtml(aiResponse);
        }

        async function generateInterviewQuestions(button) {
            const sectionCard = button.closest('.glass-card');
            const title = sectionCard.querySelector('h3').textContent.trim().replace(/^\d+\s*/, '');
            
            openModal(`Suggested Questions for ${title}`, '<div class="loading-spinner"></div>');

            let sectionItems = '';
            sectionCard.querySelectorAll('.checklist-item span').forEach(span => {
                sectionItems += `- ${span.textContent}\n`;
            });

            const prompt = `
                You are an expert HR interviewer specializing in global compliance for healthcare roles.
                For the assessment category "${title}", which covers the following checklist items:
                ${sectionItems}
                
                Please generate 3-5 insightful and open-ended interview questions to ask a candidate to effectively evaluate their competency in this specific area. The questions should be practical and scenario-based where possible.
                
                Format the response as a Markdown bulleted list.
            `;
            
            const aiResponse = await callGeminiAPI(prompt);
            document.getElementById('modal-body').innerHTML = showdownConverter.makeHtml(aiResponse);
        }

        function exportAssessment() {
            const title = "Export Assessment Report";
            const content = `
                <p>Please provide the following details for the report file.</p>
                <div style="margin-bottom: 1rem;">
                    <label for="exportCandidateName" style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Candidate Name</label>
                    <input type="text" id="exportCandidateName" placeholder="e.g., Jane Doe" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border); background: var(--dark); color: var(--text); font-size: 1rem;">
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label for="exportAssessorName" style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Your Name (Assessor)</label>
                    <input type="text" id="exportAssessorName" placeholder="e.g., John Smith" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border); background: var(--dark); color: var(--text); font-size: 1rem;">
                </div>
                <button class="calculate-btn" style="width: 100%;" onclick="proceedWithExport()">Generate & Download Report</button>
            `;
            openModal(title, content);
        }

        function proceedWithExport() {
            const candidateName = document.getElementById('exportCandidateName').value.trim();
            const assessorName = document.getElementById('exportAssessorName').value.trim() || 'HR Team';
            
            if (!candidateName) {
                showNotification("Candidate name is required to generate the report.", "danger");
                return;
            }
            
            let report = `INTELLECT CROSS-BORDER HIRING ASSESSMENT\n`;
            report += `=======================================\n\n`;
            report += `Candidate: ${candidateName}\n`;
            report += `Assessment Date: ${new Date().toLocaleDateString()}\n`;
            report += `Assessed by: ${assessorName}\n\n`;
            
            document.querySelectorAll('.glass-card:not(.progress-sidebar)').forEach(sectionCard => {
                 const titleElement = sectionCard.querySelector('h3');
                 if (!titleElement) return;
                 const sectionTitle = titleElement.textContent.trim().replace(/^\d+\s*/, '');
                 report += `\n--- ${sectionTitle.toUpperCase()} ---\n`;
                 sectionCard.querySelectorAll('.checklist-item').forEach(item => {
                    const checkbox = item.querySelector('input[type="checkbox"]');
                    const status = checkbox.checked ? '✓' : '○';
                    const text = item.querySelector('span').textContent;
                    report += `${status} ${text}\n`;
                 });
            });

            const completed = document.querySelectorAll('input[type="checkbox"]:checked').length;
            const total = document.querySelectorAll('input[type="checkbox"]').length;
            
            report += `\n\nASSESSMENT SUMMARY\n`;
            report += `==================\n`;
            report += `Total Assessment Points: ${total}\n`;
            report += `Completed Assessments: ${completed}\n`;
            report += `Assessment Progress: ${total > 0 ? Math.round((completed / total) * 100) : 0}%\n\n`;
            
            report += `CROSS-BORDER CAPABILITY NOTES:\n`;
            report += `_____________________________________________\n`;
            report += `\n[Add jurisdiction coverage summary here]\n`;
            report += `[Add market-specific limitations here]\n`;
            report += `[Add expansion opportunities here]\n`;
            
            const blob = new Blob([report], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Intellect_CrossBorder_Assessment_${candidateName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            closeModal();
        }
    </script>
</body>
</html>
